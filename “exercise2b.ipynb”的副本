{"cells":[{"cell_type":"markdown","source":["#### This submission is for... (*put up to three people*)\n","- Erika Mustermann (87654321)\n","- Max Mustermann (12345678)\n","- Maxine Musterfrau (87651234)"],"metadata":{"cell_id":"3e896117cb0846b29129965572826152","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":153.171875,"id":"B2K_UbEd5Jjk"}},{"cell_type":"markdown","source":["# Exercise 2B - Generative Adversarial Networks"],"metadata":{"formattedRanges":[],"cell_id":"ad3b27583aa44fa29cc5a854c32c2c38","tags":[],"is_collapsed":false,"owner_user_id":"175a6e67-5f66-4c81-960a-2a75fbd3d9af","deepnote_cell_type":"text-cell-h1","id":"6RmvJ9Gl5Jjp"}},{"cell_type":"markdown","source":["In this exercise, you need to build a simple generative adversarial network to perform image generation."],"metadata":{"formattedRanges":[],"cell_id":"5deb652947b24adbb6ef154023a03e39","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-p","id":"EtPEL8jI5Jjp"}},{"cell_type":"markdown","source":["**Important Notice**: Throughout the notebook, basic structures are provided such as functions and classes without bodies or partial bodies, and variables that you need to assign to. **Don't change the names of functions, variables, and classes - and make sure that you are using them!** You're allowed to introduce helper variables and functions. Occasionally, we use **type annotations** that you should follow. They are not enforced by Python. Whenenver you see an ellipsis `...` or TODO comment, you're supposed to insert code."],"metadata":{"cell_id":"416d4a259823408c9aa2f49c418c89ff","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":141.953125,"id":"R9HRHyWX5Jjq"}},{"cell_type":"markdown","source":["## Task: Image generation"],"metadata":{"cell_id":"3bf1d3d0025344f5ac7ab42e437ce2eb","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":70,"id":"6H6xcSYH5Jjq"}},{"cell_type":"markdown","source":["In this assignment, you will be asked to implement Generative Adversarial Network (GAN) and train it in order to perform image generation. The idea is to learn the training data distribution by your model and use this model to synthesize new images from the corresponding distribution."],"metadata":{"formattedRanges":[],"cell_id":"6b9b3ab97b234d2880b96b795ddea299","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-p","id":"quSUphpB5Jjq"}},{"cell_type":"markdown","source":["In GAN, we basically have two different models; generator and discriminator. While the Generator is responsible for synthesizing images and try to fool the Discriminator, Discriminator tries to distinguish real and fake samples. Our Discriminator network is a traditional classification network that performs binary classification; real and fake. Therefore, we will train our Discriminator with real and fake samples to learn to distinguish them. On the other hand, our the Generator is a generative model that takes a random noise, that is sampled from a known distribution (e.g., Uniform distribution), and tries to synthesize an image by performing upsampling. The goal of the Generator is to get \"real\" output from the Discriminator for the output that it synthesized. Meanwhile, the Discriminator goal is to recognize that the synthesized image by the Generator is fake."],"metadata":{"formattedRanges":[],"cell_id":"184616428c6c49d591f26d47332956d8","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-p","id":"ww-V2jko5Jjr"}},{"cell_type":"markdown","source":["We need to train both network simultaneously, therefore, we follow minimax game strategy and use the following formula:"],"metadata":{"formattedRanges":[],"cell_id":"f87ddea3502a4fec88523642f39adec5","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-p","id":"YUStacLp5Jjr"}},{"cell_type":"markdown","source":["$$\\underset{G}{min}\\; \\underset{D}{max}\\; E_{x\\sim p_{data}} [logD(x)] + E_{z\\sim p(z)}[log(1-D(G(z)))]$$"],"metadata":{"cell_id":"6ea7513dec0547bd922bd9f5eec8d894","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":58.59375,"id":"nOGMcEW35Jjs"}},{"cell_type":"markdown","source":["where $z \\sim p(z)$ are the random noise that we sample, D represents the Discriminator network, $ x \\sim p(data) $ indicates the real/training data distribution, and G states the Generator network. "],"metadata":{"cell_id":"42d2681b49a44b539f28c85397290317","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":74.78125,"id":"LTJkR-Hh5Jjs"}},{"cell_type":"markdown","source":["### Rules\n","In the assignment, we provide some basic codes or function names. You should follow the provided structure and only fill the blocks start with TODO keyword and end with END keyword. If you think that the provided code blocks and functions are not enough to do some steps / process or if you think that there are missing details, then you are allowed to add further codes / blocks / functions. However, please explain why you need it / them.\n","\n","Besides, please do not forget to include your comments to the codes that you will write.\n","\n","It is forbidden to get codes from the internet. Please implement yourself.\n","\n","You are allowed to do the assignment as a group (maximum of 3 people). You can also do it alone.\n","\n","If you implement the requested functions for the other exercise(s) (e.g., exercise 1 or exercise 2a), you can use the same code by just copy-paste from there and put a comment about it.\n","\n","Please submit your file / files as a .zip and the name should be NN2022_assignment2_studentsID.zip. Inside the .zip, there should be a README file that should contain student ID, first name and last name. If you do it as a group, it is enough to do the submission one time but do not forget to write student ID, first name and last name of all members of your group. You can directly submit your file to dogucan.yaman@kit.edu"],"metadata":{"cell_id":"90bb2763aac34b9593381432ab6f6298","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":439.078125,"id":"ZhoqFEvC5Jjt"}},{"cell_type":"code","metadata":{"cell_id":"7bd482d406e94f90951bf089dd0fff46","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"8724ddeb","execution_start":1657026883891,"execution_millis":4217,"deepnote_cell_type":"code","deepnote_cell_height":293.375,"id":"0koVOcbB5Jjt","outputId":"5de740a1-eab6-4428-de13-ef35aff128f3"},"source":["import numpy as np\n","import torch\n","import torchvision\n","import torchvision.transforms as transforms\n","from tqdm import tqdm\n","import matplotlib.pyplot as plt\n","import matplotlib.gridspec as gridspec\n","import torch.nn as nn\n","from torch.autograd import Variable\n","from torch import Tensor"],"execution_count":null,"outputs":[{"name":"stderr","text":"/shared-libs/python3.7/py/lib/python3.7/site-packages/tqdm/auto.py:22: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm\n","output_type":"stream"}]},{"cell_type":"markdown","source":["### Utility functions"],"metadata":{"formattedRanges":[],"cell_id":"d745a20deddc4b9ba2727d2bacf5f0d8","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"_De7eune5Jjv"}},{"cell_type":"code","metadata":{"cell_id":"ed43282dabfe4043ad954f876fb8ba5d","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"41e7ac11","execution_start":1656949593817,"execution_millis":8,"deepnote_cell_type":"code","deepnote_cell_height":526,"id":"oNHERi_x5Jjv"},"source":["def show_images(images):\n","    # visualize an image\n","    images = np.reshape(images, [images.shape[0], -1])  # images reshape to (batch_size, D)\n","    sqrtn = int(np.ceil(np.sqrt(images.shape[0])))\n","    sqrtimg = int(np.ceil(np.sqrt(images.shape[1])))\n","\n","    fig = plt.figure(figsize=(sqrtn, sqrtn))\n","    gs = gridspec.GridSpec(sqrtn, sqrtn)\n","    gs.update(wspace=0.05, hspace=0.05)\n","\n","    for i, img in enumerate(images):\n","        ax = plt.subplot(gs[i])\n","        plt.axis('off')\n","        ax.set_xticklabels([])\n","        ax.set_yticklabels([])\n","        ax.set_aspect('equal')\n","        plt.imshow(img.reshape([sqrtimg,sqrtimg]))\n","    return\n","\n","def preprocess_img(x):\n","    # Normalize the image to be between [-1, 1]\n","    return ((x / 255.0) * 2) - 1\n","\n","def deprocess_img(x):\n","    # Denormalize the image to be between [0, 255]\n","    return ((x + 1) / 2) * 255.0"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Read dataset"],"metadata":{"formattedRanges":[],"cell_id":"5e6dcb5ff1dc41afb0fd7a099efae7c5","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"tVQFYEg95Jjw"}},{"cell_type":"markdown","source":["##### MNIST dataset \n","\n","- Hand written digit dataset\n","- 10 classes in total [0, 9]\n","- 60000 training images\n","- 10000 test images\n","- Grayscale images\n","- 28 $ \\times $ 28 $ \\times $ 1"],"metadata":{"cell_id":"5fe89ae5ac6944bbac605bfac652d090","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":229.34375,"id":"VgOOYJ_m5Jjw"}},{"cell_type":"code","metadata":{"cell_id":"c627ce8b649a46559ef9684e7db4c738","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"a42ec5e7","execution_start":1656949596657,"execution_millis":875,"deepnote_cell_type":"code","deepnote_cell_height":998.75,"id":"C7N9agHq5Jjw"},"source":["# You can change batch size according to your hardware\n","batch_size = 4\n","\n","shuffle = True\n","\n","transform_mnist = transforms.Compose([\n","                transforms.ToTensor(),\n","                transforms.Normalize((0.1307,), (0.3081,))\n","])\n","\n","mnist_dataset_train = torchvision.datasets.MNIST('/tmp/mnist/data', \n","                                            train=True, \n","                                            download=True, \n","                                            transform=transform_mnist)\n","\n","mnist_dataset_test = torchvision.datasets.MNIST('/tmp/mnist/data', \n","                                            train=False, \n","                                            download=True, \n","                                            transform=transform_mnist)\n","\n","data_loader_train = torch.utils.data.DataLoader(mnist_dataset_train,\n","                                        batch_size=batch_size,\n","                                        shuffle=shuffle,\n","                                        num_workers=1)\n","\n","data_loader_test = torch.utils.data.DataLoader(mnist_dataset_test,\n","                                        batch_size=1,\n","                                        shuffle=False,\n","                                        num_workers=1)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"cell_id":"389139a1ce444c7b95c343acf89a1e05","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"7b03627d","execution_start":1656949599774,"execution_millis":573,"deepnote_cell_type":"code","deepnote_cell_height":373.375,"deepnote_output_heights":[null,125],"id":"fys1_A5z5Jjw","outputId":"462c2e00-2982-4d57-edbe-ff7b7d3168c1"},"source":["sample = next(iter(data_loader_train))\n","print(sample[0].shape) # images\n","print(sample[1].shape) # labels\n","\n","# Visualize a batch of images from the training set\n","show_images(sample[0])"],"execution_count":null,"outputs":[{"name":"stdout","text":"torch.Size([4, 1, 28, 28])\ntorch.Size([4])\n","output_type":"stream"},{"data":{"text/plain":"<Figure size 144x144 with 4 Axes>","image/png":"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\n"},"metadata":{"needs_background":"light","image/png":{"width":124,"height":123}},"output_type":"display_data"}]},{"cell_type":"markdown","source":["### Implementation of basic components"],"metadata":{"formattedRanges":[],"cell_id":"0193e2f29e094001a0ea56a7c05a955e","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"MAGWjaQh5Jjx"}},{"cell_type":"markdown","source":["In this block, you need to implement some operations and activation functions that you will be using when you design your generator and discriminator. You are not allowed to use off-the-shelf PyTorch functions for these operations such torch.nn.Conv2d"],"metadata":{"cell_id":"46969fb8820b4fe994fe1e72ad64c234","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":97.171875,"id":"LR6GwEXR5Jjx"}},{"cell_type":"code","source":["class Linear_layer(nn.Module):\n","    # Implement a linear layer with a forward pass that you will be able to use during the architecture design\n","    def __init__(self, number_of_neuron):\n","        super(ResnetBlock, self).__init__()\n","        self.number_of_neuron = number_of_neuron\n","\n","    def forward(x:Tensor) -> Tensor:\n","        \"\"\"\n","        x: data\n","        Implement forward pass\n","        \"\"\"\n","        output = None\n","        return output\n","\n","def Upsampling_layer(x, size=None, scale_factor=None):\n","    \"\"\"\n","    Implement upsamling layer by using bilinear approach\n","    Input:\n","        x: input data\n","        size: output spatial size. It can be a scalar or a tuple\n","        scale_factor: scale factor to perform upsampling\n","    Output:\n","        output_map: Upsampled version of the input data x\n","    \"\"\"\n","    return output_map\n","\n","def max_pooling(x, filter_size=2, stride=2):\n","    \"\"\"\n","    Implement max pooling operation for an arbitrary input\n","    Input:\n","        x: input\n","        filter_size: abstract filter size to define the region size to perform pooling operation\n","        stride: step size for each movement between regions\n","    Output:\n","        output_map: output of max pooling operation\n","    \"\"\"\n","    return output_map\n","\n","def relu_function(x):\n","    \"\"\"\n","    x: input data\n","    \"\"\"\n","\n","    # Implement relu activation function\n","\n","    # TODO\n","\n","    # END\n","    return \n","\n","def tanh_function(x):\n","    \"\"\"\n","    x: input data\n","    \"\"\"\n","\n","    # Implement tanh activation function\n","    # TODO\n","\n","    # END\n","    return\n","\n","def sigmoid_function(x):\n","    \"\"\"\n","    x: input data\n","    \"\"\"\n","\n","    # Implement sigmoid activation function\n","    # TODO\n","\n","    # END\n","    return\n","\n","def leakyrelu_function(x, alpha=0.1):\n","    \"\"\"\n","    Implement Leaky ReLU activation function\n","    Input:\n","        x: data\n","        alpha: coefficient to use on the negative side\n","    Output:\n","        output: output of the LReLU function\n","    \"\"\"\n","    return output"],"metadata":{"cell_id":"57375c8e4f1b4c3db1474c787cd7004e","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"2211363e","execution_start":1656950453914,"execution_millis":8,"deepnote_cell_type":"code","deepnote_cell_height":1539,"id":"2Jty9Y6s5Jjx"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["## Vanilla GAN"],"metadata":{"formattedRanges":[],"cell_id":"c13f19af0c0a40f696c23a71ceb5993c","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h2","id":"yxdMza9H5Jjy"}},{"cell_type":"markdown","source":["### Generator"],"metadata":{"formattedRanges":[],"cell_id":"e2443dcabf2e4d4b81b30e8ccaf54eeb","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"li1HdWl55Jjy"}},{"cell_type":"markdown","source":["\n","- Fully-connected layer from latent_dim to 1024\n","- ReLU activation function\n","- Fully-connected layer from 1024 to 1024\n","- ReLU activation function\n","- Fully-connected layer from 1024 to 784 (Output image: $ 28 \\times 28 \\times 1 $)\n","- TanH activation function\n"],"metadata":{"cell_id":"a3995acc001443a9b71d6bf7c0561117","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":196.34375,"id":"0diI1pua5Jjy"}},{"cell_type":"code","source":["class VanillaGenerator(torch.nn.Module):\n","    def __init__(self, latent_dim, img_shape):\n","        super(VanillaGenerator, self).__init__()        \n","        self.img_shape = img_shape\n","\n","        # Define Generator's layers\n","        # TODO\n","\n","        # END\n","        \n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the generator\n","        \"\"\"\n","        # Implement forward step of the model\n","        # TODO\n","\n","        # END\n","        return output"],"metadata":{"cell_id":"ed79cd6be18f4d5a80df67d2670fce1c","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"b0770b1e","execution_start":1656949622030,"execution_millis":3,"deepnote_cell_type":"code","deepnote_cell_height":418,"id":"ap7qJey95Jjy"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Discriminator"],"metadata":{"formattedRanges":[],"cell_id":"0fc7c7d7e1264b3b85d67a65b7f49649","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"bNngMoW35Jjy"}},{"cell_type":"markdown","source":["- Fully-connected layer from 784 ($ 28 \\times 28 \\times 1 $) to 256\n","- LeakyReLU activation function with $ \\alpha = 0.01 $\n","- Fully-connected layer from 256 to 256\n","- LeakyReLU activation function with $ \\alpha = 0.01 $\n","- Fully-connected layer from 256 to 1\n"],"metadata":{"cell_id":"c2b2ff7e7e8e4950ba9d1ad45ff4fc6e","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":170.953125,"id":"_UHKzv_N5Jjy"}},{"cell_type":"code","metadata":{"cell_id":"b9024a62374b407eb7a44dc4981dc7ef","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"5556c932","execution_start":1656949623706,"execution_millis":3,"deepnote_cell_type":"code","deepnote_cell_height":364,"id":"cinVnRXi5Jjy"},"source":["class VanillaDiscriminator(nn.Module):\n","    def __init__(self, img_shape):\n","        super(VanillaDiscriminator, self).__init__()\n","        \n","        # Define Discriminator's layers \n","\n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the discriminator\n","        \"\"\"\n","\n","        # Implement forward step of the model\n","        # TODO\n","\n","        # END\n","        return output"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Define Optimizer"],"metadata":{"formattedRanges":[],"cell_id":"cd0dc89e593c4352958eedb3618c058a","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"FrheNkBe5Jjz"}},{"cell_type":"code","metadata":{"cell_id":"46cef483939a4d8b82f798d34ecad83c","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"225d278c","execution_start":1656949707748,"execution_millis":6,"deepnote_cell_type":"code","deepnote_cell_height":274,"id":"8U09vrMF5Jjz"},"source":["def get_optimizer(model):\n","    \"\"\"\n","    Define an Adam optimizer with 1e-3 learning rate, 0.5 beta1, and 0.999 beta2 parameters\n","    \n","    Input:\n","        model: Provided model\n","    \n","    Returns:\n","        optimizer: An Adam optimizer with provided parameters\n","    \"\"\"\n","    return optimizer\n"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Create model"],"metadata":{"formattedRanges":[],"cell_id":"e99a7b93d19a4dc98c8cecec8fefa529","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"BxYJ1EQz5Jjz"}},{"cell_type":"code","metadata":{"cell_id":"961c076d77e849e0b6401ddf9e8342b6","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"b600361c","execution_start":1656949653739,"execution_millis":24,"deepnote_cell_type":"code","deepnote_cell_height":663.875,"deepnote_output_heights":[193.875],"id":"ojoGWEhp5Jjz","outputId":"060eb05f-e61a-4021-be2b-ee1c57665d00"},"source":["latent_dim = 100 # you can change this\n","\n","# Define generator and discriminator\n","# TODO\n","\n","generator_vanilla = None\n","\n","# END\n","\n","# Perform weight initialization\n","# TODO\n","\n","discriminator_vanilla = None\n","\n","# END\n","\n","print(generator_vanilla)\n","print(discriminator_vanilla)\n","\n","# Get optimizer\n","optimizer_vanilla_G = get_optimizer(generator_vanilla)\n","optimizer_vanilla_D = get_optimizer(discriminator_vanilla)"],"execution_count":null,"outputs":[{"output_type":"execute_result","execution_count":10,"data":{"text/plain":"VanillaDiscriminator(\n  (model): Sequential(\n    (0): Linear(in_features=784, out_features=512, bias=True)\n    (1): ReLU()\n    (2): Linear(in_features=512, out_features=256, bias=True)\n    (3): ReLU()\n    (4): Linear(in_features=256, out_features=1, bias=True)\n    (5): Sigmoid()\n  )\n)"},"metadata":{}}]},{"cell_type":"markdown","source":["### Generate random noise"],"metadata":{"formattedRanges":[],"cell_id":"e61f2195d63e40e0ad35e4645af41f82","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"G3_GuU7W5Jjz"}},{"cell_type":"code","metadata":{"cell_id":"8eeb0c03a069437f94c4c57a5d34d73c","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"16dd3044","execution_start":1656949710635,"execution_millis":4,"deepnote_cell_type":"code","deepnote_cell_height":310,"id":"FwMTmvEP5Jj0"},"source":["def generate_noise(batch_size, latent_dim):\n","    \"\"\"\n","    Sample random noise from uniform distribution in the range  [-1, 1]\n","    Input:\n","        batch_size: The batch size of the noise \n","        latent_dim: Dimension of the noise\n","    Output:\n","        A noise of shape (batch_size, latent_dim) and between -1 and +1\n","    \"\"\"\n","\n","    # TODO\n","\n","    # END\n","    return random_noise"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### GAN loss"],"metadata":{"formattedRanges":[],"cell_id":"2da6abf2a4dc4f75aa7edbd069253e05","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"PA6IsmKr5Jj0"}},{"cell_type":"code","source":["class binary_cross_entropy_loss(nn.Module):\n","    def __init__(self):\n","        super(binary_cross_entropy_loss, self).__init__()\n","\n","    def forward(self, pred, target):\n","        loss = None\n","        \"\"\"\n","        Implement binary cross entropy loss\n","        pred: predictions\n","        target: ground truth labels\n","        \"\"\"\n","        # TODO\n","\n","        # END\n","        return loss\n","\n","class generator_loss(nn.Module):\n","    def __init__(self):\n","        super(generator_loss, self).__init__()\n","        self.bce_loss = binary_cross_entropy_loss()\n","\n","    def forward(self, scores):\n","        \"\"\"\n","        Implement generator loss by using self.bce_loss\n","        Input:\n","            scores: Output scores for the generated data\n","        Output:\n","            loss: Calculated loss value for the generator. It must be a scalar.\n","        \"\"\"\n","        loss = None\n","        # TODO\n","\n","        # END\n","        return loss\n","\n","class discriminator_loss(nn.Module):\n","    def __init__(self):\n","        super(discriminator_loss, self).__init__()\n","        self.bce_loss = binary_cross_entropy_loss()\n","\n","    def forward(self, scores_real, scores_fake):\n","        \"\"\"\n","        Implement discriminator loss by using self.bce_loss\n","        Input:\n","            scores_real: Output scores for the real data\n","            scores_fake: Output scores for the generated data\n","        Output:\n","            loss: Calculated loss value for the discriminator. It must be a scalar.\n","        \"\"\"\n","        loss = None\n","        # TODO\n","\n","        # END\n","        return loss\n"],"metadata":{"cell_id":"36445ef93d69465db58828fb042048c1","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"337730e","execution_start":1656949713400,"execution_millis":4,"deepnote_cell_type":"code","deepnote_cell_height":1048,"id":"RZ_adkGq5Jj0"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Training"],"metadata":{"formattedRanges":[],"cell_id":"43ad8ba7c2f54e869ade94299abe6ca0","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"Ie2VnOEl5Jj0"}},{"cell_type":"code","metadata":{"cell_id":"5bd8c5b2a32e48009115474864411386","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"6dc529f5","execution_start":1656949759172,"execution_millis":689738,"deepnote_cell_type":"code","deepnote_cell_height":1265.1875,"id":"cUUib02x5Jj0"},"source":["total_epoch = 10 # you can change this\n","cuda = False # you can change this\n","Tensor = torch.cuda.FloatTensor if cuda else torch.FloatTensor\n","\n","# Get loss function(s)\n","# TODO\n","\n","# END\n","\n","if cuda:\n","    generator_vanilla.cuda()\n","    discriminator_vanilla.cuda()\n","\n","for epoch in range(total_epoch):\n","    for i, (imgs, _) in enumerate(data_loader_train):\n","        \"\"\"\n","        - Train one step discriminator\n","        - Train one step generator\n","        - Calculate necessary loss functions and perform optimization / weight update\n","        - Perform generation in the end of each epoch, calculate loss, save a batch of generated image\n","        \"\"\"\n","\n","        # TODO\n","\n","        # END\n","        \n","        print(\"[Epoch %d/%d] [Batch %d/%d] [D loss: %f] [G loss: %f]\" % (epoch, total_epoch, i, len(data_loader_train), d_loss.item(), g_loss.item()))\n"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Visualization"],"metadata":{"formattedRanges":[],"cell_id":"68c262a454d144c98f85bf1e35451629","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"PMGveRvD5Jj1"}},{"cell_type":"code","metadata":{"cell_id":"0df838638c4d4b659bf01c7ccc1ffe84","tags":[],"deepnote_to_be_reexecuted":false,"source_hash":"23df68a2","execution_start":1656950588467,"execution_millis":273,"deepnote_cell_type":"code","deepnote_cell_height":335.1875,"deepnote_output_heights":[null,125],"id":"mqujEOvW5Jj1","outputId":"ebdc77ef-525a-4fe9-fdff-86516b7f4e32"},"source":["input_noise = Tensor(generate_noise(batch_size, latent_dim))\n","gen_imgs = generator_vanilla(input_noise)\n","print(gen_imgs.shape)\n","# Visualize generated image\n","show_images(gen_imgs.detach())"],"execution_count":null,"outputs":[{"name":"stdout","text":"torch.Size([28, 28, 1])\n","output_type":"stream"},{"data":{"text/plain":"<Figure size 144x144 with 4 Axes>","image/png":"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\n"},"metadata":{"needs_background":"light","image/png":{"width":124,"height":123}},"output_type":"display_data"}]},{"cell_type":"markdown","source":["## Deep Convolutional GAN (DCGAN)"],"metadata":{"formattedRanges":[],"cell_id":"6fea739965d94667aea5d5663f1c4c68","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h2","id":"KmSsGT8d5Jj1"}},{"cell_type":"markdown","source":["In the VanillaGAN, we only had fully-connected layers. However, in order to implement deep convolutional generative adversarial network (DCGAN), we need to have convolution layers. In the following code blocks, you first need to implement Conv layer and Transposed Conv layer. Afterwards, you will use them to design your Generator and Discriminator."],"metadata":{"cell_id":"f08fc87334134fc88b2f4d634ca3d8c2","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":97.171875,"id":"uIA0KjTX5Jj1"}},{"cell_type":"markdown","source":["### Conv Layer"],"metadata":{"cell_id":"06e445edb8454abe810e3eee3e453e6a","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":62,"id":"Af16291_5Jj1"}},{"cell_type":"code","metadata":{"cell_id":"abcdc9ad2955420f94ee3b286c94248c","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":367,"id":"29nWoNMc5Jj1"},"source":["class ConvLayer(nn.Module):\n","    def __init__(self, kernel_size=3, stride=1, padding=0):\n","        super(ConvLayer, self).__init__()        \n","\n","        # Define Convolution operation\n","        # TODO\n","\n","        # END\n","        \n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the convolution layer\n","        \"\"\"\n","        # TODO\n","\n","        # END\n","        return output"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Transposed Conv Layer"],"metadata":{"cell_id":"87feb2475a8848ef8c26ce784406c167","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":62,"id":"7y8YShBg5Jj1"}},{"cell_type":"code","metadata":{"cell_id":"3e8c7f9c5d6d40bcab56cb899a890981","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":367,"id":"blQHLkkG5Jj2"},"source":["class TransposedConvLayer(nn.Module):\n","    def __init__(self, kernel_size=3, stride=1, padding=1, output_padding=1):\n","        super(TransposedConvLayer, self).__init__()        \n","\n","        # Define Transposed Convolution operation\n","        # TODO\n","\n","        # END\n","        \n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the transposed convolution layer\n","        \"\"\"\n","        # TODO\n","\n","        # END\n","        return output"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Generator"],"metadata":{"formattedRanges":[],"cell_id":"164fa0ca12f142bfbebcf08fc440af30","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"TgHY7SIp5Jj2"}},{"cell_type":"code","metadata":{"cell_id":"f96207f559f84d4a8137223a959b5ddd","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":403,"id":"rY44Cg4j5Jj2"},"source":["class DCGenerator(nn.Module):\n","    def __init__(self, latent_dim, img_shape):\n","        super(DCGenerator, self).__init__()        \n","        self.img_shape = img_shape\n","\n","        # Define Generator's layers\n","        # TODO\n","\n","        # END\n","        \n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the generator\n","        \"\"\"\n","        # Implement forward step of the model\n","        # TODO\n","\n","        # END\n","        return output"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Discriminator"],"metadata":{"formattedRanges":[],"cell_id":"5bc5abd8062840eeaccff17316500cdb","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"BIFN8Vnk5Jj2"}},{"cell_type":"code","metadata":{"cell_id":"99405d403a4441f997c9e27ea5f27502","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":349,"id":"2DfrlHZg5Jj4"},"source":["class DCDiscriminator(nn.Module):\n","    def __init__(self, img_shape):\n","        super(DCDiscriminator, self).__init__()\n","        \n","        # Define Discriminator's layers \n","\n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the discriminator\n","        \"\"\"\n","\n","        # Implement forward step of the model\n","        # TODO\n","\n","        # END\n","        return output"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Create Model"],"metadata":{"formattedRanges":[],"cell_id":"181fff929e214d62b62fc5725d0d24f0","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"Xkj9PhAT5Jj5"}},{"cell_type":"code","metadata":{"cell_id":"3599f221dc2d4543b4cfd11ad0df2903","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":313,"id":"tIbH7y6a5Jj5"},"source":["latent_dim = 100 # you can change this\n","\n","# Define generator and discriminator\n","# TODO\n","dc_generator = None\n","# END\n","\n","# Perform weight initialization\n","# TODO\n","dc_discriminator = None\n","# END\n","\n","# Get optimizer\n","optimizer_dc_G = get_optimizer(dc_generator)\n","optimizer_dc_D = get_optimizer(dc_discriminator)"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Training"],"metadata":{"formattedRanges":[],"cell_id":"922b569b745245dc8d5799f083e675f8","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"ieFQ6Eal5Jj5"}},{"cell_type":"code","metadata":{"cell_id":"6331daa271c5492086f51ea680ab3db2","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":552,"id":"bWqI2so05Jj5"},"source":["total_epoch = 10 # you can change this\n","cuda = False # you can change this\n","Tensor = torch.cuda.FloatTensor if cuda else torch.FloatTensor\n","\n","# Get loss function(s)\n","# TODO\n","\n","# END\n","\n","if cuda:\n","    dc_generator.cuda()\n","    dc_discriminator.cuda()\n","\n","for epoch in range(total_epoch):\n","    for i, (imgs, _) in enumerate(data_loader_train):\n","        \"\"\"\n","        - Train one step discriminator\n","        - Train one step generator\n","        - Calculate necessary loss functions and perform optimization / weight update\n","        - Perform generation in the end of each epoch, calculate loss, save a batch of generated image\n","        \"\"\"\n","\n","        # TODO\n","\n","        # END\n","        \n","        print(\"[Epoch %d/%d] [Batch %d/%d] [D loss: %f] [G loss: %f]\" % (epoch, total_epoch, i, len(data_loader_train), d_loss.item(), g_loss.item()))\n"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Visualization"],"metadata":{"formattedRanges":[],"cell_id":"4a805ba2b18745a4a7fa5df0bb53fc76","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"xH-GMZO_5Jj5"}},{"cell_type":"code","metadata":{"cell_id":"9ee628fc0a914a578a5039197dbe2202","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":133,"id":"rj51fnrf5Jj5"},"source":["input_noise = Tensor(generate_noise(batch_size, latent_dim))\n","gen_imgs = dc_generator(input_noise)\n","print(gen_imgs.shape)\n","# Visualize generated image\n","show_images(gen_imgs.detach())"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["## Improvements"],"metadata":{"formattedRanges":[],"cell_id":"dd7247792dec4daead46d8064dffb6ba","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h2","id":"PccL6U4l5Jj5"}},{"cell_type":"markdown","source":["### Generator"],"metadata":{"formattedRanges":[],"cell_id":"61c8b466986c4c6da1b55776d90643a9","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"jZUsoIYF5Jj6"}},{"cell_type":"code","metadata":{"cell_id":"96cc746a492f4a55b891bb5d252165b0","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":457,"id":"y-hN_xAF5Jj6"},"source":["\"\"\"\n","Transposed convolution instead of upsampling\n","\"\"\"\n","class ImprovedGenerator(nn.Module):\n","    def __init__(self, latent_dim, img_shape):\n","        super(ImprovedGenerator, self).__init__()        \n","        self.img_shape = img_shape\n","\n","        # Define Generator's layers\n","        # TODO\n","\n","        # END\n","        \n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the generator\n","        \"\"\"\n","        # Implement forward step of the model\n","        # TODO\n","\n","        # END\n","        return output"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Discriminator"],"metadata":{"formattedRanges":[],"cell_id":"a9e6ed7b45be4e3ba5bac3060fd69edc","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"TXYjMlce5Jj6"}},{"cell_type":"markdown","source":["**Spectral normalization**\n","\n","Please check for the details: \n","- https://paperswithcode.com/method/spectral-normalization\n","- https://arxiv.org/abs/1802.05957\n","\n","**Least square discriminator**\n","- https://paperswithcode.com/method/lsgan\n","\n","**Apply leaky relu activation function in Discriminator**\n","\n","<center><figure><img src=\"https://i.imgur.com/y9jXuP4.jpg\" width=\"600\"/><figcaption>Graph of the ReLU (left) and LReLU (right) activation functions. <a href=\"https://qph.cf2.quoracdn.net/main-qimg-68345231be6cb497732a056a51868d98-lq\">Image is taken from</a></figcaption></figure></center>"],"metadata":{"cell_id":"bac696ca01ec4f6986fa0b6b888d02de","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":980.5625,"id":"gME8DbdE5Jj6"}},{"cell_type":"code","source":["class SpectralNormalization(nn.Module):\n","    def __init__(self):\n","        super(SpectralNormalization, self).__init__()\n","\n","    def forward(self, x):\n","        norm_output = None\n","        # TODO\n","        # Implement spectral normalization\n","\n","        # END TODO\n","        return norm_output\n","\n","class ImprovedDiscriminator(nn.Module):\n","    def __init__(self, img_shape):\n","        super(ImprovedDiscriminator, self).__init__()\n","        \n","        # Define Discriminator's layers \n","\n","    def forward(self, x):\n","        \"\"\"\n","        x: input data\n","        output: output of the discriminator\n","        \"\"\"\n","\n","        # Implement forward step of the model\n","        # TODO\n","\n","        # END\n","        return output"],"metadata":{"cell_id":"1704f6f38a364a3485eddc4ae1edbba9","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":565,"id":"aLKx_d5b5Jj6"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["#### Improved Loss Functions\n","\n","You need to implement Mean Squared Error (MSE), improved generator loss and improved discriminator loss. The idea is based on the improvement that you do in the discriminator. Since our discriminator generates 2D output without linear layer, we need to adapt our GAN loss based on this concept."],"metadata":{"cell_id":"5dc93ba56d0543eaa2c4daa4208528fe","tags":[],"deepnote_cell_type":"markdown","deepnote_cell_height":133.171875,"id":"YPesSu045Jj6"}},{"cell_type":"code","source":["class MSE_loss(nn.Module):\n","    def __init__(self):\n","        super(MSE_loss, self).__init__()\n","\n","    def forward(self, pred, target):\n","        loss = None\n","        \"\"\"\n","        Implement mean squared error (MSE) loss\n","        pred: predictions\n","        target: ground truth\n","        \"\"\"\n","        # TODO\n","\n","        # END\n","        return loss\n","\n","class improved_generator_loss(nn.Module):\n","    def __init__(self):\n","        super(improved_generator_loss, self).__init__()\n","        self.mse_loss = MSE_loss()\n","\n","    def forward(self, scores):\n","        \"\"\"\n","        Implement generator loss by using self.mse_loss\n","        Input:\n","            scores: Output scores for the generated data\n","        Output:\n","            loss: Calculated loss value for the generator. It must be a scalar.\n","        \"\"\"\n","        loss = None\n","        # TODO\n","\n","        # END\n","        return loss\n","\n","class improved_discriminator_loss(nn.Module):\n","    def __init__(self):\n","        super(improved_discriminator_loss, self).__init__()\n","        self.mse_loss = MSE_loss()\n","\n","    def forward(self, scores_real, scores_fake):\n","        \"\"\"\n","        Implement discriminator loss by using self.mse_loss\n","        Input:\n","            scores_real: Output scores for the real data\n","            scores_fake: Output scores for the generated data\n","        Output:\n","            loss: Calculated loss value for the discriminator. It must be a scalar.\n","        \"\"\"\n","        loss = None\n","        # TODO\n","\n","        # END\n","        return loss"],"metadata":{"cell_id":"235e538bdda34152a26a86256139c038","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":1015,"id":"gw4AzusL5Jj6"},"outputs":[],"execution_count":null},{"cell_type":"markdown","source":["### Create model"],"metadata":{"formattedRanges":[],"cell_id":"b175ee2eb6304c4e86d624825c20a9ea","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"5wiEFg4e5Jj7"}},{"cell_type":"code","metadata":{"cell_id":"625c5a8017e3449aa26accdf57219f3e","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":313,"id":"_DhR8wDz5Jj7"},"source":["latent_dim = 100 # you can change this\n","\n","# Define generator and discriminator\n","# TODO\n","improved_generator = None\n","# END\n","\n","# Perform weight initialization\n","# TODO\n","improved_discriminator = None\n","# END\n","\n","# Get optimizer\n","optimizer_imp_G = get_optimizer(improved_generator)\n","optimizer_imp_D = get_optimizer(improved_discriminator)"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Training"],"metadata":{"formattedRanges":[],"cell_id":"78f143c40ec4468f83f3b576e8681e18","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"DKWe0tJ_5Jj7"}},{"cell_type":"code","metadata":{"cell_id":"f995ca1e1de049cb93ee1124b4b5e409","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":552,"id":"LALJQ1Ir5Jj7"},"source":["total_epoch = 10 # you can change this\n","cuda = False # you can change this\n","Tensor = torch.cuda.FloatTensor if cuda else torch.FloatTensor\n","\n","# Get loss function(s)\n","# TODO\n","\n","# END\n","\n","if cuda:\n","    improved_generator.cuda()\n","    improved_discriminator.cuda()\n","\n","for epoch in range(total_epoch):\n","    for i, (imgs, _) in enumerate(data_loader_train):\n","        \"\"\"\n","        - Train one step discriminator\n","        - Train one step generator\n","        - Calculate necessary loss functions and perform optimization / weight update\n","        - Perform generation in the end of each epoch, calculate loss, save a batch of generated image\n","        \"\"\"\n","\n","        # TODO\n","\n","        # END\n","        \n","        print(\"[Epoch %d/%d] [Batch %d/%d] [D loss: %f] [G loss: %f]\" % (epoch, total_epoch, i, len(data_loader_train), d_loss.item(), g_loss.item()))\n"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### Visualization"],"metadata":{"formattedRanges":[],"cell_id":"091e5a397fd949dbbc90871f28c5e287","tags":[],"is_collapsed":false,"deepnote_cell_type":"text-cell-h3","id":"dTq_VxTK5Jj7"}},{"cell_type":"code","metadata":{"cell_id":"e8ddc79d6075488b960a43a96570f471","tags":[],"deepnote_cell_type":"code","deepnote_cell_height":133,"id":"_lu3byJB5Jj7"},"source":["input_noise = Tensor(generate_noise(batch_size, latent_dim))\n","gen_imgs = improved_generator(input_noise)\n","print(gen_imgs.shape)\n","# Visualize generated image\n","show_images(gen_imgs.detach())"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["<a style='text-decoration:none;line-height:16px;display:flex;color:#5B5B62;padding:10px;justify-content:end;' href='https://deepnote.com?utm_source=created-in-deepnote-cell&projectId=faa4af3b-d086-4f42-8b7d-d29c91b1d0f6' target=\"_blank\">\n","<img alt='Created in deepnote.com' style='display:inline;max-height:16px;margin:0px;margin-right:7.5px;' src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iODBweCIgaGVpZ2h0PSI4MHB4IiB2aWV3Qm94PSIwIDAgODAgODAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU0LjEgKDc2NDkwKSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT5Hcm91cCAzPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IkxhbmRpbmciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyMzUuMDAwMDAwLCAtNzkuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSJHcm91cC0zIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjM1LjAwMDAwMCwgNzkuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cG9seWdvbiBpZD0iUGF0aC0yMCIgZmlsbD0iIzAyNjVCNCIgcG9pbnRzPSIyLjM3NjIzNzYyIDgwIDM4LjA0NzY2NjcgODAgNTcuODIxNzgyMiA3My44MDU3NTkyIDU3LjgyMTc4MjIgMzIuNzU5MjczOSAzOS4xNDAyMjc4IDMxLjY4MzE2ODMiPjwvcG9seWdvbj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0zNS4wMDc3MTgsODAgQzQyLjkwNjIwMDcsNzYuNDU0OTM1OCA0Ny41NjQ5MTY3LDcxLjU0MjI2NzEgNDguOTgzODY2LDY1LjI2MTk5MzkgQzUxLjExMjI4OTksNTUuODQxNTg0MiA0MS42NzcxNzk1LDQ5LjIxMjIyODQgMjUuNjIzOTg0Niw0OS4yMTIyMjg0IEMyNS40ODQ5Mjg5LDQ5LjEyNjg0NDggMjkuODI2MTI5Niw0My4yODM4MjQ4IDM4LjY0NzU4NjksMzEuNjgzMTY4MyBMNzIuODcxMjg3MSwzMi41NTQ0MjUgTDY1LjI4MDk3Myw2Ny42NzYzNDIxIEw1MS4xMTIyODk5LDc3LjM3NjE0NCBMMzUuMDA3NzE4LDgwIFoiIGlkPSJQYXRoLTIyIiBmaWxsPSIjMDAyODY4Ij48L3BhdGg+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMCwzNy43MzA0NDA1IEwyNy4xMTQ1MzcsMC4yNTcxMTE0MzYgQzYyLjM3MTUxMjMsLTEuOTkwNzE3MDEgODAsMTAuNTAwMzkyNyA4MCwzNy43MzA0NDA1IEM4MCw2NC45NjA0ODgyIDY0Ljc3NjUwMzgsNzkuMDUwMzQxNCAzNC4zMjk1MTEzLDgwIEM0Ny4wNTUzNDg5LDc3LjU2NzA4MDggNTMuNDE4MjY3Nyw3MC4zMTM2MTAzIDUzLjQxODI2NzcsNTguMjM5NTg4NSBDNTMuNDE4MjY3Nyw0MC4xMjg1NTU3IDM2LjMwMzk1NDQsMzcuNzMwNDQwNSAyNS4yMjc0MTcsMzcuNzMwNDQwNSBDMTcuODQzMDU4NiwzNy43MzA0NDA1IDkuNDMzOTE5NjYsMzcuNzMwNDQwNSAwLDM3LjczMDQ0MDUgWiIgaWQ9IlBhdGgtMTkiIGZpbGw9IiMzNzkzRUYiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+' > </img>\n","Created in <span style='font-weight:600;margin-left:4px;'>Deepnote</span></a>"],"metadata":{"tags":[],"created_in_deepnote_cell":true,"deepnote_cell_type":"markdown","id":"YOc1ngHj5Jj7"}}],"nbformat":4,"nbformat_minor":0,"metadata":{"orig_nbformat":2,"deepnote":{},"deepnote_notebook_id":"0ef88d28-5a2b-456c-9445-1fca5be00f9d","deepnote_execution_queue":[],"colab":{"name":"exercise2b.ipynb","provenance":[{"file_id":"1XsOaOgqUXULFUZg1dDKa9a26qha4C-PE","timestamp":1659475897153}]},"language_info":{"name":"python"},"kernelspec":{"name":"python3","display_name":"Python 3"},"gpuClass":"standard"}}